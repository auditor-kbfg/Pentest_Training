import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText

def send_email(subject, body, to_email, from_email, smtp_server, smtp_port, smtp_user, smtp_password):
    print("이메일 전송 프로세스 시작")

    # 이메일 메시지 생성
    msg = MIMEMultipart()
    msg['From'] = from_email
    msg['To'] = to_email
    msg['Subject'] = subject

    # 이메일 본문 추가
    msg.attach(MIMEText(body, 'plain'))

    try:
        print(f"SMTP 서버에 연결 시도: {smtp_server}:{smtp_port}")
        # SMTP 서버에 연결
        server = smtplib.SMTP(smtp_server, smtp_port)
        server.set_debuglevel(1)  # 디버깅 레벨 설정
        server.starttls()  # TLS 암호화 사용
        print("TLS 암호화 시작")

        print("SMTP 서버에 로그인 시도")
        server.login(smtp_user, smtp_password)  # 로그인
        print("로그인 성공")

        print("이메일 발송 시도")
        server.sendmail(from_email, to_email, msg.as_string())  # 이메일 발송
        print("이메일 발송 성공")

        server.quit()  # 서버 연결 종료
        print('서버 연결 종료')
    except smtplib.SMTPException as e:
        print(f'이메일 전송 실패: SMTPException: {e}')
    except Exception as e:
        print(f'이메일 전송 실패: 일반 예외: {e}')

# 사용자 입력
subject = '테스트 이메일'
body = '이것은 파이썬을 이용한 테스트 이메일입니다.'
to_email = 'xparkjc@naver.com'
from_email = 'parkjc@kbfg.com'
smtp_server = 'ekpwmoz1.kbstar.com'
smtp_port = 25  # 일반적으로 587 포트 사용
smtp_user = 'id'
smtp_password = 'passwd'

# 이메일 발송 함수 호출
send_email(subject, body, to_email, from_email, smtp_server, smtp_port, smtp_user, smtp_password)
